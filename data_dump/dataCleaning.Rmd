---
title: "TeamsCleaning"
author: "Aaron Simot"
date: "10/25/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
install.packages("hash")
```


```{R libraries, include = FALSE}
library(tidyverse)
library(hash)
```


```{R data_load_bat, include = FALSE}

#reading in the teams batting standards data
teamsBat <- read_csv2(here::here("data_dump/teamsBattingStandards1900_2020"))
teamsPitch <- read_csv2(here::here("data_dump/teamsPitchingStandards1900_2020"))

```



```{R cleaning_bats}

#selecting columns that need to be converted to numeric
cols <- colnames(teamsBat)
cols <- cols[2:30]

#removing all the summary values for each year that was extracted
cleanTeamsBat <- teamsBat %>%
  #cleaning out some of the column headers and league averages saved as team data
  filter(!is.na(Tm), Tm != "League Average", Tm != "Tm")

#have to switch back char columns to numeric from initial scrape file
#needed to convert all to char due to map_df issues thinking column names were datapoints
cleanTeamsBat[cols] <- sapply(cleanTeamsBat[cols], as.numeric) #converting numeric cols back to numeric

#cleanTeamsBat

```



```{R clean_pitch}
#selecting columns that need to be converted to numeric
colsPitch <- colnames(teamsPitch)
colsPitch <- colsPitch[2:37]

#removing all the summary values for each year that was extracted
cleanTeamsPitch <- teamsPitch %>%
  #cleaning out some of the column headers and league averages saved as team data
  filter(!is.na(Tm), Tm != "League Average", Tm != "Tm")

#have to switch back char columns to numeric from initial scrape file
#needed to convert all to char due to map_df issues thinking column names were datapoints
cleanTeamsPitch[colsPitch] <- sapply(cleanTeamsPitch[colsPitch], as.numeric) #converting numeric cols back to numeric

#cleanTeamsPitch

```

Notable name changes:
  *Tampa Bay Devil Rays -> Tampa Bay Rays
  *Los Angeles Angels -> California Angels -> Anaheim Angels -> Los Angeles Angels of Anaheim -> Los Angeles Angels
  *Montreal Expos -> Washington Nationals -> Washington Senators
  *Houston Colt .45s -> Houston Astros
  *Milwaukee Braves -> Atlanta Braves
  *Kansas City Athletics -> Oakland Athletics
  *Seattle Pilots -> Milwaukee Brewers

```{r name_changes}

cleanTeamsBat <- cleanTeamsBat %>%
  #retaining our desired year subset for displays
  filter(year >= 1960)

cleanTeamsPitch <- cleanTeamsPitch %>%
  #retaining our desired year subset for displays
  filter(year >= 1960)

teamNames <- unique(cleanTeamsBat$Tm)
teamNames
```



```{r dictionary_create}

# Creating list of team name abbreviations
abbrList <- c("BAL", "BOS", "CHC", "CWS", "CIN", "CLE", "DET", "KC",
              "LAD", "MIL", "NYY", "PHI", "PIT", "SF", "STL", "WSH",
              "LAA", "MIN", "HOU", "NYM", "CAL", "HOU", "ATL", "OAK", 
              "KC", "MTL", "SD", "SEA", "MIL", "TEX", "SEA", "TOR", 
              "COL", "FLA", "ANA", "ARI", "TB", "LAA", "WSH", "TB", 
              "MIA")

# Creating the dictionary to pair team names in full to their respective abbreviations
teamDict <- hash(teamNames, abbrList)
teamDict2 <- hash(abbrList, teamNames)
# sort(abbrList)

```

```{r apply_abbreviations}

#teamDict[["Miami Marlins"]]

#use dictionary to assign team name abbreviations based on Tm column for Bat table
cleanTeamsBat <- cleanTeamsBat %>%
  mutate(TmAbbr = values(teamDict, keys = Tm))

#use dictionary to assign team name abbreviations based on Tm column for Pitch table
cleanTeamsPitch <- cleanTeamsPitch %>%
  mutate(TmAbbr = values(teamDict, keys = Tm))

```



```{r validation}
# Reordering columns

# Moving order to Team, year, everything else
cleanTeamsBat <- cleanTeamsBat[,c(1,31, 30, 2:29)]

# Moving order to be Team, year, everything else
cleanTeamsPitch <- cleanTeamsPitch[, c(1, 38, 36, 2:35, 37)]

```



```{R exports}
#exporting the partially cleaned teams batting data
write_csv2(cleanTeamsBat, here::here("data_dump/cleanTeamsBat1900_2020"))

#exporting the partially cleaned teams pitching data
write_csv2(cleanTeamsPitch, here::here("data_dump/cleanTeamsPitch1900_2020"))
```


```{r, include = FALSE}
MVPdata <- read_csv2(here::here("data_dump/MVP1960_2020"))
CYdata <- read_csv2(here::here("data_dump/CY1960_2020"))
Rookiedata <- read_csv2(here::here("data_dump/Rookie1960_2020"))
```




```{r}
#Move the first row to be the col names
colnames(MVPdata) <-MVPdata[1,]
# Getting rid of the first row, last col and years before 1960
MVPC <- MVPdata[2:184,1:17]
#Dropping the rows that have only NA
MVPClean <- MVPC %>% 
  drop_na(Year) %>%
  filter(Year >= 1960) %>%
  # Assigning standard team abbreviations
  mutate(Tm = case_when(Tm == "CHW" ~ "CWS", 
                        Tm == "WSN" ~ "WSH", 
                        Tm == "SFG" ~ "SF",
                        Tm == "SDP" ~ "SD", 
                        Tm == "KCR" ~ "KC",
                        TRUE ~ Tm)) %>%
  # Applying dictionary to assign full team names
  mutate(TmName = values(teamDict2, keys = Tm))

```



```{r}
# Getting last col and years before 1960
CYC <- CYdata[1:176,1:11]
#Dropping the rows that have only NA
CYClean <- CYC %>% 
  drop_na(Year) %>%
  filter(Year >= 1960) %>%
  # Changing abbreviations to standard naming
  mutate(Tm = case_when(Tm == "CHW" ~ "CWS", 
                        Tm == "WSN" ~ "WSH", 
                        Tm == "SFG" ~ "SF",
                        Tm == "SDP" ~ "SD", 
                        Tm == "KCR" ~ "KC",
                        Tm == "TBR" ~ "TB", 
                        Tm == "MON" ~ "MTL",
                        TRUE ~ Tm)) %>%
  # Applying dictionary to assign full team name based on abbreviations
  mutate(TmName = values(teamDict2, keys = Tm))

```



```{r}
#Move the first row to be the col names
colnames(Rookiedata) <-Rookiedata[1,]
# Getting rid of the first row, last col and years before 1960
RookieC <- Rookiedata[2:185,1:17]
#Dropping the rows that have only NA
RookieClean <- RookieC %>% 
  drop_na(Year) %>%
  filter(Year >= 1960) %>%
  # Changing abbreviations to standard names
  mutate(Tm = case_when(Tm == "CHW" ~ "CWS", 
                        Tm == "WSN" ~ "WSH", 
                        Tm == "SFG" ~ "SF",
                        Tm == "SDP" ~ "SD", 
                        Tm == "KCR" ~ "KC",
                        Tm == "TBR" ~ "TB", 
                        Tm == "MON" ~ "MTL",
                        TRUE ~ Tm)) %>%
  # Applying dictionary
  mutate(TmName = values(teamDict2, keys = Tm))
```


```{r}
# Rearranging Columns
MVPClean <- MVPClean[, c(1:4, 18, 5:17)]
RookieClean <- RookieClean[, c(1:4, 18, 5:17)]
CYClean <- CYClean[, c(1:4, 12, 5:11)]

```



```{r}
#exporting the Cleaned MVP stats
#write_csv2(MVPClean, here::here("data_dump/MVPClean1960_2020"))

#exporting the cleaned Cy Young stats
#write_csv2(CYClean, here::here("data_dump/CYClean1960_2020"))

#exporting the cleaned Rookie stats

#write_csv2(RookiedClean, here::here("data_dump/RookieClean1960_2020"))
write_csv2(RookieClean, here::here("data_dump/RookieClean1960_2020"))

```

```{r}
save(MVPClean, file = "MVPClean1960_2020.Rdata")

save(CYClean, file = "CYClean1960_2020.Rdata")

save(RookieClean, file = "RookieClean1960_2020.Rdata")
```

